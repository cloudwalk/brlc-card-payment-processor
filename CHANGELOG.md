# Current version

## Main changes

1. The new `resendCashback()` function has been introduced to fix possible issues with cashback. The function resends the cashback for the payment with a given authorization ID, applying  the new cashback rate if the current rate is zero. A new cashback nonce is generated by the `CashbackDistributor` smart contract and replaced in the `Cashback` struct related to the payment.

2. The new function fails in the following cases:
    * The contract is paused.
    * The caller does not have the {EXECUTOR_ROLE} role.
    * The cashback operations are not configured.
    * The provided new cashback rate is zero.
    * The provided new cashback rate exceeds the allowable maximum specified in the {MAX_CASHBACK_RATE_IN_PERMIL} constant.
    * The payment does not exist or has status that is not  "Uncleared", "Cleared", or "Confirmed" ones.
    * The current payment cashback rate is not zero.

3. If successful, the new function emits the existing `SendCashbackSuccess` event in the `CardPaymentProcessor` smart contract along with the `SendCashback` event in the `CashbackDistributor` smart contract.

## Migration

No special actions are required for already deployed smart contracts, just upgrade them.

# 1.4.1

## Main Changes

### CashbackDistributor

- The `revokeCashback` method reverts with an "insufficient allowance" error when a a cashback receiver account has no sufficient token allowance to revoke cashback.
- The `OutOfBalance` revocation status has higher priority than `OutOfFunds`.

## Migration steps

No special actions are required for already deployed smart contracts, just upgrade them.

# 1.4.0
